<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calorie Counter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Calorie Counter</h1>
        <hr>
        <h2>Add Dish at Menu</h2>
        <form method="POST" action="/add">
            <input type="text" name="name" placeholder="Dish Name" required>
            <input type="number" name="protein" placeholder="Protein" required>
            <input type="number" name="fat" placeholder="Fat" required>
            <input type="number" name="carbs" placeholder="Carbs" required>
            <input type="number" name="calories" placeholder="Calories" required>
            <button type="submit" class="btn btn-primary">Add Dish</button>
        </form>
        <hr>
        <h2>Menu</h2>
        <ul class="list-group">
            {% for dish in dishes %}
                <li class="list-group-item">
                    {{ dish[1] }}: {{ dish[2] }} cal
                    <a href="/edit/{{ dish[0] }}" class="btn btn-warning btn-sm">Edit</a>
                    <form action="/delete/{{ dish[0] }}" method="post" style="display:inline-block;">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
        <hr>
        
        <h2>History of Consumed Dishes</h2>
        
        <hr>
        <ul class="list-group">
            {% for item in consumed %}
                <li class="list-group-item">
                    {{ item[0] }}: {{ item[1] }} grams ({{ item[2] * (item[1] / 100) }} cal) consumed on {{ item[3].strftime('%Y-%m-%d %H:%M:%S') }}
                </li>
            {% endfor %}
        </ul>

        <hr>
        <h2>Choose Dish from Menu</h2>
        <form method="POST" action="/consume">
            <select name="dish_id" required>
                <option value="" disabled selected>Select a dish</option>
                {% for dish in dishes %}
                    <option value="{{ dish[0] }}">{{ dish[1] }} ({{ dish[2] }} cal)</option>
                {% endfor %}
            </select>
            <input type="number" name="quantity" placeholder="Quantity in grams" required>
            <button type="submit" class="btn btn-primary">Add Consumed Dish</button>
        </form>
        <hr>
        <h3>Calorie Graph (Last 10 Minutes)</h3>
        <canvas id="calorieChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        fetch('/chart')
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('calorieChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'Calories Consumed',
                            data: data.data,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: true,
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            });
    </script>
</body>
</html>
